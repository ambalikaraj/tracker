<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Study Journal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
        }
        .main-container {
            max-width: 900px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .streak-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 25px;
            color: white;
            font-size: 1.1rem;
            backdrop-filter: blur(10px);
        }
        .setup-banner {
            background: #f59e0b;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        .setup-banner.success {
            background: #10b981;
        }
        .journal-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        .section-title {
            color: #667eea;
            font-weight: 600;
            font-size: 1.3rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .form-label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        .form-control, .form-select {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 12px;
            transition: all 0.3s;
        }
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        textarea.form-control {
            min-height: 80px;
        }
        .form-select {
            cursor: pointer;
        }
        .btn-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 15px 40px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            width: 100%;
            transition: transform 0.2s;
        }
        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .stats-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        .stats-number {
            font-size: 2.5rem;
            font-weight: 700;
        }
        .stats-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .history-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .entry-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .entry-date {
            font-weight: 700;
            color: #667eea;
            font-size: 1.1rem;
        }
        .entry-subject {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }
        .entry-meta {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            font-size: 0.9rem;
            color: #718096;
        }
        .btn-delete {
            background: #fc8181;
            border: none;
            color: white;
            padding: 6px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
        }
        .btn-export {
            background: #48bb78;
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 10px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .emoji-icon {
            font-size: 1.5rem;
        }
        .code-box {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Setup Banner -->
        <div id="setupBanner" class="setup-banner">
            ‚ö†Ô∏è <strong>Setup Required:</strong> Please configure Firebase below (takes 5 minutes)
        </div>

        <!-- Header -->
        <div class="header">
            <h1>‚ú® My Study Journal</h1>
            <p style="color: rgba(255,255,255,0.9); margin-bottom: 10px;">üì° Real-time sync with your study group</p>
            <div class="streak-badge">
                üî• <span id="streakDays">0</span> entries logged
            </div>
        </div>

        <!-- Setup Instructions -->
        <div class="journal-card" id="setupCard">
            <div class="section-title">
                <span class="emoji-icon">üî•</span> Firebase Setup (One-Time Only)
            </div>
            <div style="background: #f0f9ff; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h6 style="color: #0369a1; margin-bottom: 15px;">üìã Follow these steps:</h6>
                <ol style="color: #0c4a6e; line-height: 2.2;">
                    <li><strong>Go to Firebase Console:</strong> <a href="https://console.firebase.google.com" target="_blank">console.firebase.google.com</a></li>
                    <li><strong>Create Project:</strong> Click "Add project" ‚Üí Name it "Study Tracker" ‚Üí Continue</li>
                    <li><strong>Disable Google Analytics</strong> (not needed) ‚Üí Create project</li>
                    <li><strong>Add Web App:</strong> Click the "</>" (Web) icon ‚Üí Register app (name: "Study Tracker")</li>
                    <li><strong>Copy Firebase Config:</strong> You'll see a code like this:
                        <div class="code-box">
const firebaseConfig = {<br>
&nbsp;&nbsp;apiKey: "AIza...",<br>
&nbsp;&nbsp;authDomain: "...",<br>
&nbsp;&nbsp;databaseURL: "...",<br>
&nbsp;&nbsp;projectId: "...",<br>
&nbsp;&nbsp;storageBucket: "...",<br>
&nbsp;&nbsp;messagingSenderId: "...",<br>
&nbsp;&nbsp;appId: "..."<br>
};
                        </div>
                    </li>
                    <li><strong>Enable Realtime Database:</strong> 
                        <ul style="margin-top: 10px;">
                            <li>Left sidebar ‚Üí Build ‚Üí Realtime Database ‚Üí Create Database</li>
                            <li>Choose location (closest to you) ‚Üí Next</li>
                            <li>Start in <strong>Test mode</strong> ‚Üí Enable</li>
                        </ul>
                    </li>
                    <li><strong>Copy Database URL:</strong> It looks like: <code>https://your-project.firebaseio.com</code></li>
                    <li><strong>Paste values below</strong> and click Save</li>
                </ol>
            </div>
            
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">API Key</label>
                    <input type="text" class="form-control" id="apiKey" placeholder="AIza...">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Project ID</label>
                    <input type="text" class="form-control" id="projectId" placeholder="study-tracker-xxxxx">
                </div>
                <div class="col-12">
                    <label class="form-label">Database URL</label>
                    <input type="text" class="form-control" id="databaseURL" placeholder="https://your-project.firebaseio.com">
                </div>
                <div class="col-12">
                    <button class="btn btn-save" onclick="saveFirebaseConfig()">üî• Save & Connect to Firebase</button>
                </div>
                <div class="col-12">
                    <small class="text-muted">üí° Your config is saved locally and securely. Only you and people you share the URL with can access the data.</small>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="row" id="statsSection" style="display: none;">
            <div class="col-md-4 mb-3">
                <div class="stats-card">
                    <div class="stats-number" id="totalHours">0</div>
                    <div class="stats-label">Total Hours</div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="stats-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <div class="stats-number" id="totalEntries">0</div>
                    <div class="stats-label">Study Sessions</div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="stats-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <div class="stats-number" id="avgRating">0</div>
                    <div class="stats-label">Avg. Satisfaction</div>
                </div>
            </div>
        </div>

        <!-- Journal Entry Form -->
        <div class="journal-card" id="mainForm" style="display: none;">
            <div class="section-title">
                <span class="emoji-icon">üìù</span> Today's Study Session
            </div>
            <form id="studyForm">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">üìÖ Date</label>
                        <input type="date" class="form-control" id="date" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">üìö Subject / Topic</label>
                        <input type="text" class="form-control" id="subject" placeholder="e.g., Mathematics, Physics" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label">‚è∞ Time Invested (hours)</label>
                        <input type="number" class="form-control" id="hours" step="0.5" min="0" placeholder="e.g., 2.5" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">üìñ What Did You Study?</label>
                        <input type="text" class="form-control" id="topics" placeholder="Main topics covered">
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">‚úÖ Problems Solved</label>
                        <select class="form-select" id="problems" required>
                            <option value="">Select honestly...</option>
                            <option value="Less">Less than expected</option>
                            <option value="Decent">Decent amount</option>
                            <option value="Satisfied">Satisfied with count</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">üîÑ Topics Revised</label>
                        <textarea class="form-control" id="revised" placeholder="List topics you revised today" style="min-height: 60px;"></textarea>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">üíö Today's Wins / What Went Well <span style="color: #e53e3e; font-size: 0.85rem;">(min 20 words)</span></label>
                        <textarea class="form-control" id="wins" placeholder="What did you do well today? Be specific..." required></textarea>
                        <small class="text-muted"><span id="winsCount">0</span> words</small>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">üìà Areas to Improve / Mistakes (Galtis) <span style="color: #e53e3e; font-size: 0.85rem;">(min 20 words)</span></label>
                        <textarea class="form-control" id="improvements" placeholder="What can be improved? Be honest with yourself..." required></textarea>
                        <small class="text-muted"><span id="improvementsCount">0</span> words</small>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">üéØ Focus Level</label>
                        <select class="form-select" id="focusSelect" required>
                            <option value="">Choose honestly...</option>
                            <option value="1">1 - Extremely distracted, couldn't concentrate</option>
                            <option value="2">2 - Very distracted, mind wandering constantly</option>
                            <option value="3">3 - Distracted, struggled to stay on task</option>
                            <option value="4">4 - Below average, frequent breaks needed</option>
                            <option value="5">5 - Average, some distractions but manageable</option>
                            <option value="6">6 - Good, mostly focused with minor lapses</option>
                            <option value="7">7 - Very good, well-focused throughout</option>
                            <option value="8">8 - Excellent, deep focus with rare breaks</option>
                            <option value="9">9 - Outstanding, highly concentrated</option>
                            <option value="10">10 - Perfect flow state, zero distractions</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">üòä Satisfaction Level</label>
                        <select class="form-select" id="satisfactionSelect" required>
                            <option value="">Be honest with yourself...</option>
                            <option value="1">1 - Very unsatisfied, wasted time</option>
                            <option value="2">2 - Quite unsatisfied, poor session</option>
                            <option value="3">3 - Unsatisfied, didn't achieve much</option>
                            <option value="4">4 - Below expectations, could do better</option>
                            <option value="5">5 - Okay, neither good nor bad</option>
                            <option value="6">6 - Satisfied, decent progress made</option>
                            <option value="7">7 - Good, happy with what I learned</option>
                            <option value="8">8 - Very satisfied, productive session</option>
                            <option value="9">9 - Highly satisfied, excellent progress</option>
                            <option value="10">10 - Extremely satisfied, best session ever</option>
                        </select>
                    </div>

                    <div class="col-12">
                        <label class="form-label">üöÄ What's Next Tomorrow?</label>
                        <textarea class="form-control" id="tomorrow" placeholder="Plan for your next study session"></textarea>
                    </div>

                    <div class="col-12">
                        <button type="submit" class="btn-save">üíæ Save Today's Entry</button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Export Button -->
        <div id="exportSection" style="display: none;">
            <button class="btn-export w-100" onclick="exportToExcel()">üìä Download Full History as Excel</button>
        </div>

        <!-- History -->
        <div class="history-card" id="historySection" style="display: none;">
            <div class="section-title">
                <span class="emoji-icon">üìö</span> Your Study History (Real-time)
            </div>
            <div id="historyList"></div>
        </div>
    </div>

    <script>
        let database;
        let entries = [];

        function checkSetup() {
            const config = localStorage.getItem('firebaseConfig');
            if (config) {
                const firebaseConfig = JSON.parse(config);
                initializeFirebase(firebaseConfig);
            }
        }

        function saveFirebaseConfig() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const projectId = document.getElementById('projectId').value.trim();
            const databaseURL = document.getElementById('databaseURL').value.trim();

            if (!apiKey || !projectId || !databaseURL) {
                alert('‚ö†Ô∏è Please fill in all fields');
                return;
            }

            const firebaseConfig = {
                apiKey: apiKey,
                authDomain: `${projectId}.firebaseapp.com`,
                databaseURL: databaseURL,
                projectId: projectId,
                storageBucket: `${projectId}.appspot.com`,
                messagingSenderId: "123456789",
                appId: "1:123456789:web:abcdef"
            };

            localStorage.setItem('firebaseConfig', JSON.stringify(firebaseConfig));
            alert('‚úÖ Firebase configured! Connecting...');
            initializeFirebase(firebaseConfig);
        }

        function initializeFirebase(config) {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(config);
                }
                database = firebase.database();
                
                document.getElementById('setupCard').style.display = 'none';
                document.getElementById('setupBanner').className = 'setup-banner success';
                document.getElementById('setupBanner').innerHTML = '‚úÖ <strong>Connected to Firebase!</strong> Real-time sync is active üî•';
                document.getElementById('mainForm').style.display = 'block';
                document.getElementById('statsSection').style.display = 'flex';
                document.getElementById('exportSection').style.display = 'block';
                document.getElementById('historySection').style.display = 'block';
                
                loadData();
                document.getElementById('date').valueAsDate = new Date();
            } catch (error) {
                alert('‚ùå Firebase connection failed. Please check your configuration: ' + error.message);
                console.error(error);
            }
        }

        function countWords(text) {
            return text.trim().split(/\s+/).filter(word => word.length > 0).length;
        }

        document.getElementById('wins').addEventListener('input', function() {
            const count = countWords(this.value);
            document.getElementById('winsCount').textContent = count;
            document.getElementById('winsCount').style.color = count >= 20 ? '#27ae60' : '#e53e3e';
        });

        document.getElementById('improvements').addEventListener('input', function() {
            const count = countWords(this.value);
            document.getElementById('improvementsCount').textContent = count;
            document.getElementById('improvementsCount').style.color = count >= 20 ? '#27ae60' : '#e53e3e';
        });

        checkSetup();

        document.getElementById('studyForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const winsCount = countWords(document.getElementById('wins').value);
            const improvementsCount = countWords(document.getElementById('improvements').value);
            
            if (winsCount < 20) {
                alert('‚ö†Ô∏è Please write at least 20 words in "Today\'s Wins" field for meaningful reflection.');
                return;
            }
            
            if (improvementsCount < 20) {
                alert('‚ö†Ô∏è Please write at least 20 words in "Areas to Improve" field. Be honest with yourself!');
                return;
            }
            
            const entry = {
                timestamp: Date.now(),
                date: document.getElementById('date').value,
                subject: document.getElementById('subject').value,
                hours: parseFloat(document.getElementById('hours').value),
                topics: document.getElementById('topics').value,
                wins: document.getElementById('wins').value,
                improvements: document.getElementById('improvements').value,
                problems: document.getElementById('problems').value,
                revised: document.getElementById('revised').value,
                focus: parseInt(document.getElementById('focusSelect').value),
                satisfaction: parseInt(document.getElementById('satisfactionSelect').value),
                tomorrow: document.getElementById('tomorrow').value
            };

            try {
                await database.ref('entries').push(entry);
                alert('üéâ Entry saved successfully! Everyone can see it now!');
                
                this.reset();
                document.getElementById('date').valueAsDate = new Date();
                document.getElementById('winsCount').textContent = '0';
                document.getElementById('improvementsCount').textContent = '0';
            } catch (error) {
                alert('‚ùå Failed to save: ' + error.message);
                console.error(error);
            }
        });

        function loadData() {
            database.ref('entries').on('value', (snapshot) => {
                entries = [];
                snapshot.forEach((child) => {
                    entries.push({
                        id: child.key,
                        ...child.val()
                    });
                });
                displayData();
            });
        }

        function displayData() {
            const historyList = document.getElementById('historyList');
            let historyHTML = '';
            
            let totalHours = 0;
            let totalSatisfaction = 0;
            
            if (entries.length === 0) {
                historyHTML = '<p class="text-center text-muted">No entries yet. Start your journey today! üöÄ</p>';
            }
            
            entries.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach((entry) => {
                totalHours += entry.hours;
                totalSatisfaction += entry.satisfaction;
                
                historyHTML += `
                    <div class="entry-item">
                        <div class="entry-header">
                            <span class="entry-date">${entry.date}</span>
                            <button class="btn-delete" onclick="deleteEntry('${entry.id}')">üóëÔ∏è Delete</button>
                        </div>
                        <div class="entry-subject">${entry.subject}</div>
                        <div class="entry-meta">
                            <span>‚è∞ ${entry.hours}h</span>
                            <span>‚úÖ ${entry.problems}</span>
                            <span>üéØ Focus: ${entry.focus}/10</span>
                            <span>üòä ${entry.satisfaction}/10</span>
                        </div>
                        ${entry.wins ? `<p style="margin-top: 10px; color: #2d7a4f;"><strong>üíö Wins:</strong> ${entry.wins}</p>` : ''}
                        ${entry.improvements ? `<p style="margin-top: 5px; color: #c05621;"><strong>üìà To Improve:</strong> ${entry.improvements}</p>` : ''}
                    </div>
                `;
            });

            historyList.innerHTML = historyHTML;

            document.getElementById('totalHours').textContent = totalHours.toFixed(1);
            document.getElementById('totalEntries').textContent = entries.length;
            document.getElementById('avgRating').textContent = entries.length ? (totalSatisfaction / entries.length).toFixed(1) : '0';
            document.getElementById('streakDays').textContent = entries.length;
        }

        function deleteEntry(id) {
            if (confirm('‚ùå Delete this entry? This will affect all users.')) {
                database.ref('entries/' + id).remove()
                    .then(() => {
                        console.log('Entry deleted');
                    })
                    .catch((error) => {
                        alert('Failed to delete: ' + error.message);
                    });
            }
        }

        function exportToExcel() {
            if (entries.length === 0) {
                alert('No data to export!');
                return;
            }

            const data = entries.map(e => ({
                Date: e.date,
                Subject: e.subject,
                'Hours Studied': e.hours,
                'Topics Covered': e.topics,
                'Problems Solved': e.problems,
                'Topics Revised': e.revised,
                'Focus Level': e.focus,
                'Satisfaction': e.satisfaction,
                'Todays Wins': e.wins,
                'Areas to Improve': e.improvements,
                'Tomorrow Plan': e.tomorrow
            }));

            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Study Journal');
            
            const filename = `StudyJournal_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, filename);
        }
    </script>
</body>
</html>
